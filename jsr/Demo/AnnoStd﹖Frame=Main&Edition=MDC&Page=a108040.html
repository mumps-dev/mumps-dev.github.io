<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><title>The Annotated M[UMPS] Standards</title></head>
<body bgcolor="#4c76ac" text="#ecd264" link="#bca234" vlink="#bca234">
<form method="post" action="AnnoStd.html">
<input type="hidden" name="Frame" value="Search"/>
<input type="text" name="Search" size="20"/>
<input type="submit" value="Search"/></form><table width="91%"><tr>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1977.html"><img alt="Button for 1977" border="0" src="../image/AnnoStd/1977a.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1984.html"><img alt="Button for 1984" border="0" src="../image/AnnoStd/1984a.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1990.html"><img alt="Button for 1990" border="0" src="../image/AnnoStd/1990a.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1995.html"><img alt="Button for 1995" border="0" src="../image/AnnoStd/1995a.gif"/></a></td>
<td width="13%" align="center"><img alt="Button for MDC" border="0" src="../image/AnnoStd/MDCd.gif"/></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=notes.html"><img alt="Button for notes" border="0" src="../image/AnnoStd/notesa.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=examples.html"><img alt="Button for examples" border="0" src="../image/AnnoStd/examplesa.gif"/></a></td></tr>
<tr><td align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108039&amp;Edition=MDC.html"><span style="font-size: 72px">&#9756;</span></a></td><td colspan="5" align="center"><h2>LOCK</h2><h3>Draft MDC Standard</h3></td><td align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108041&amp;Edition=MDC.html"><span style="font-size: 72px">&#9758;</span></a></td></tr></table><a name="Def_0001"></a>
<a name="Def_0002"></a>
<h3>8.2.22 Lock</h3>
<table><tr>
<td align="center">L[OCK] <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108005.html#Def_0001"><u>postcond</u></a></td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
<td align="center">[ <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0005"><u>SP</u></a> ]<br/>
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0005"><u>SP</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0001"><u>L</u></a> <a href="#Def_0003"><u>lockargument</u></a></td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
</tr></table>
<a name="Def_0003"></a>
<table><tr><td align="center">&nbsp;&nbsp;&nbsp;</td>
<td align="center"><a href="#Def_0003"><u>lockargument</u></a></td><td align="center">::=</td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;<br/>&#9474;<br/>&#9474;<br/>&#9474;</td>
<td align="center"><table><tr>
<td align="center">&#9484;<br/>&#9474;<br/>&#9492;</td>
<td align="center">+<br/>
-</td>
<td align="center">&#9488;<br/>&#9474;<br/>&#9496;</td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
<td align="center"><a href="#Def_0004"><u>nref</u></a><br/>
( <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0001"><u>L</u></a> <a href="#Def_0004"><u>nref</u></a> )</td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
<td align="center">[ <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108008.html#Def_0001"><u>timeout</u></a> ]</td>
</tr></table><br/>
@ <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107002.html#Def_0001"><u>expratom</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0002"><u>V</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0001"><u>L</u></a> <a href="#Def_0003"><u>lockargument</u></a> </td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;<br/>&#9474;<br/>&#9474;<br/>&#9474;</td>
</tr></table>
<a name="Def_0004"></a>
<table><tr><td align="center">&nbsp;&nbsp;&nbsp;</td>
<td align="center"><a href="#Def_0004"><u>nref</u></a></td><td align="center">::=</td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
<td align="center"><a href="#Def_0005"><u>rnref</u></a><br/>
@ <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107002.html#Def_0001"><u>expratom</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0002"><u>V</u></a> <a href="#Def_0004"><u>nref</u></a></td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
</tr></table>
<a name="Def_0005"></a>
<table><tr><td align="center">&nbsp;&nbsp;&nbsp;</td>
<td align="center"><a href="#Def_0005"><u>rnref</u></a></td><td align="center">::=</td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
<td align="center">[ ^ ] [ <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0006"><u>VB</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107011.html#Def_0004"><u>environment</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0006"><u>VB</u></a> ] 
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a106002.html#Def_0003"><u>name</u></a> [ ( <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0001"><u>L</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107001.html#Def_0001"><u>expr</u></a> ) ]<br/>
@ <a href="#Def_0006"><u>nrefind</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0002"><u>V</u></a> ( <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0001"><u>L</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107001.html#Def_0001"><u>expr</u></a> )</td>
<td align="center">&#9474;<br/>&#9474;<br/>&#9474;</td>
</tr></table>
<a name="Def_0006"></a>
<table><tr><td align="center">&nbsp;&nbsp;&nbsp;</td>
<td align="center"><a href="#Def_0006"><u>nrefind</u></a></td><td align="center">::=</td>
<td align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107002.html#Def_0001"><u>expratom</u></a> <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a105001.html#Def_0002"><u>V</u></a> <a href="#Def_0004"><u>nref</u></a></td>
</tr></table>
<p>Lock provides a generalized interlock facility
available to concurrently executing M[UMPS] processes to be used
as appropriate to the applications being programmed. Execution of
Lock is not affected by, nor does it directly affect, the
state or value of any global or local variable, or the value of
the <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107011.html#Def_0005">naked indicator</a>. Its use is not required to access global
variables, nor does its use inhibit other processes from
accessing global variables. It is an interlocking mechanism whose
use depends on programmers establishing and following
conventions.</p>
<p>An <a href="#Def_0004"><u>nref</u></a> is either unsubscripted or subscripted; if it
is subscripted, any number of subscripts separated by commas is
permitted.</p>
<p>When <a href="#Def_0006"><u>nrefind</u></a> is present, it is always a component of a
<a href="#Def_0005"><u>rnref</u></a>. If the value of the <a href="#Def_0005"><u>rnref</u></a> is a subscripted
form of <a href="#Def_0004"><u>nref</u></a>, then some of its subscripts may have
originated in the <a href="#Def_0006"><u>nrefind</u></a>. In this case, the subscripts
contributed by the <a href="#Def_0006"><u>nrefind</u></a> appear as the first subscripts
in the value of the resulting <a href="#Def_0005"><u>rnref</u></a>, separated by a comma
from the (non-empty) list of subscripts appearing in the rest of
the <a href="#Def_0005"><u>rnref</u></a>.</p>
<p>Each <a href="#Def_0003"><u>lockargument</u></a> specifies a subspace of the total
M[UMPS] Lock-UNIVERSE for the <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107011.html#Def_0004"><u>environment</u></a> upon
which the executing process seeks to make or release an exclusive
claim; the details of this subspace specification are given
below.</p>
<p>A special space for the lockspace is needed to create a
synchronization mechanism for the executing process for each of
the <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107011.html#Def_0004"><u>environment</u></a>s referenced by the executing process. A
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108008.html#Def_0001"><u>timeout</u></a> refers to the time spent at the target
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107011.html#Def_0004"><u>environment</u></a>, any time delays due to communication delays
are not part of the <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108008.html#Def_0001"><u>timeout</u></a>.</p>
<p>For the purposes of this discussion, the Lock-UNIVERSE
is defined as the union of all possible <a href="#Def_0004"><u>nref</u></a>s in one
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107011.html#Def_0004"><u>environment</u></a> after resolution of all indirection. Further,
there exists for each process a Lock-LIST that contains
zero or more <a href="#Def_0004"><u>nref</u></a>s. Execution of <a href="#Def_0003"><u>lockargument</u></a>s has
the effect of adding or removing <a href="#Def_0004"><u>nref</u></a>s from the process's
Lock-LIST. A given <a href="#Def_0004"><u>nref</u></a> may appear more than once
within the Lock-LIST. The <a href="#Def_0004"><u>nref</u></a>s in the
Lock-LIST specify a subset of the Lock-UNIVERSE.
This subspace, called the process's LockSPACE, consists of
the union of the subspaces specified by all <a href="#Def_0004"><u>nref</u></a>s in the
Lock-LIST, as follows:</p>
<ol type="a">
<li>If the <a href="#Def_0004"><u>nref</u></a> is unsubscripted, then the subspace is the
set of the following points: one point for the unsubscripted
variable name <a href="#Def_0004"><u>nref</u></a> and one point for each subscripted
variable name <i>N</i>(<i>s</i><sub>1</sub>, ...
,<i>s<sub>i</sub>&nbsp;</i>) where <i>N</i> has the same spelling
as <a href="#Def_0004"><u>nref</u></a>.</li>
<li>If the occurrence of <a href="#Def_0004"><u>nref</u></a> is subscripted, let the
<a href="#Def_0004"><u>nref</u></a> be <i>N</i>(<i>s</i><sub>1</sub> ,
<i>s</i><sub>2</sub> , ... , <i>s<sub>n</sub></i> ). Then the
subspace is the set of the following points: one point for
<i>N(s<sub>1</sub> , s<sub>2</sub> , ... , s<sub>n</sub> )</i>
and one point for each descendant (see 7.1.5.3 <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107086.html#Def_0002">$Data</a>
function for a definition of descendant) of <a href="#Def_0004"><u>nref</u></a>. A
subscript may not equal the empty string.</li>
</ol>
<p>If the Lock command is argumentless, Lock
removes all <a href="#Def_0004"><u>nref</u></a>s from the Lock-LIST associated
with the process executing the Lock command.</p>
<p>Execution of <a href="#Def_0003"><u>lockargument</u></a> occurs in the following
order:</p>
<ol type="a">
<li>Any expression evaluation involved in processing the
<a href="#Def_0003"><u>lockargument</u></a> is performed.</li>
<li>If the form of <a href="#Def_0003"><u>lockargument</u></a> does not include an
initial + or - sign, then prior to evaluating or executing the
rest of the <a href="#Def_0003"><u>lockargument</u></a>, Lock first removes all
<a href="#Def_0004"><u>nref</u></a>s from the Lock-LIST associated with the
process executing the Lock command. Then it appends each
of the <a href="#Def_0004"><u>nref</u></a>s in the <a href="#Def_0003"><u>lockargument</u></a> to the process's
Lock-LIST.</li>
<li>If the <a href="#Def_0003"><u>lockargument</u></a> has a leading + sign, Lock
attempts to append each of the <a href="#Def_0004"><u>nref</u></a>s in the
<a href="#Def_0003"><u>lockargument</u></a> to the process's Lock-LIST.</li>
<li>If the <a href="#Def_0003"><u>lockargument</u></a> has a leading - sign, then for each
<a href="#Def_0004"><u>nref</u></a> in the <a href="#Def_0003"><u>lockargument</u></a>, if the <a href="#Def_0004"><u>nref</u></a> exists
in the Lock-LIST for the process executing the Lock
command, one instance of <a href="#Def_0004"><u>nref</u></a> is removed from the
Lock-LIST.</li>
</ol>
<p>An error occurs, with <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107059.html#Def_0006"><u>ecode</u></a> = "<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=ab00041.html#Def_0001">M41</a>", if a
process within a TRANSACTION attempts to remove from its
Lock-LIST any <a href="#Def_0004"><u>nref</u></a> that was present when the
TRANSACTION started. With respect to each other process, the
effect of removing any <a href="#Def_0004"><u>nref</u></a> from the Lock-LIST is
deferred until the global variable modifications made since that
<a href="#Def_0004"><u>nref</u></a> was added to the Lock-LIST are available to
that other process.</p>
<p>Lock affects concurrent execution of processes having
Lock-SPACES that OVERLAP. Two Lock-SPACEs OVERLAP
when their intersection is not empty. Lock imposes the
following constraints on the concurrent execution of
processes:</p>
<ol type="a">
<li>The Lock-SPACEs of any two processes executing
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108001.html#Def_0002"><u>command</u></a>s outside the scope of a TRANSACTION may not
OVERLAP.</li>
<li>All global variable modifications produced by the execution
of <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108001.html#Def_0002"><u>command</u></a>s by processes having Lock-SPACEs that
OVERLAP must be equivalent to the modifications resulting from
some execution schedule during which their Lock-SPACEs do
not OVERLAP.</li>
</ol>
<p>See the TRANSACTION Processing subclause for the definition of
TRANSACTION.</p>
<p>The constraints imposed by Lock on the execution of
processes having Lock-SPACEs that OVERLAP may cause
execution of one or more processes to be delayed. The maximum
duration of such a delay may be specified with a
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108008.html#Def_0001"><u>timeout</u></a>.</p>
<p>If present, <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108008.html#Def_0001"><u>timeout</u></a> modifies the execution of
Lock, described above, as follows:</p>
<ol type="a">
<li>If execution of the process is delayed and cannot be resumed
prior to the expiration of <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108008.html#Def_0001"><u>timeout</u></a>, then the execution of
the <a href="#Def_0003"><u>lockargument</u></a> is unsuccessful. In this event the value
of <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107074.html#Def_0002">$Test</a> is set to zero and any <a href="#Def_0004"><u>nref</u></a>s added to the
Lock-LIST as a result of executing the <a href="#Def_0003"><u>lockargument</u></a>
are removed.</li>
<li>Otherwise, the execution of the <a href="#Def_0003"><u>lockargument</u></a> is
successful and <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107074.html#Def_0002">$Test</a> is set to one.</li>
</ol>
<p>If no <a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a108008.html#Def_0001"><u>timeout</u></a> is present, then the value of
<a href="AnnoStd%EF%B9%96Frame=Main&amp;Edition=MDC&amp;Page=a107074.html#Def_0002">$Test</a> is not affected by execution of the
<a href="#Def_0003"><u>lockargument</u></a>.</p>
<table width="91%"><tr>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1977.html"><img alt="Button for 1977" border="0" src="../image/AnnoStd/1977a.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1984.html"><img alt="Button for 1984" border="0" src="../image/AnnoStd/1984a.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1990.html"><img alt="Button for 1990" border="0" src="../image/AnnoStd/1990a.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=1995.html"><img alt="Button for 1995" border="0" src="../image/AnnoStd/1995a.gif"/></a></td>
<td width="13%" align="center"><img alt="Button for MDC" border="0" src="../image/AnnoStd/MDCd.gif"/></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=notes.html"><img alt="Button for notes" border="0" src="../image/AnnoStd/notesa.gif"/></a></td>
<td width="13%" align="center"><a href="AnnoStd%EF%B9%96Frame=Main&amp;Page=a108040&amp;Edition=examples.html"><img alt="Button for examples" border="0" src="../image/AnnoStd/examplesa.gif"/></a></td></tr></table>
<p>Copyright &copy; Standard Documents; 1977-2023 MUMPS Development Committee;<br/>
Copyright &copy; Examples: 1995-2023 Ed de Moel;<br/>
Copyright &copy; Annotations: 2003-2008 Jacquard Systems Research<br/>
Copyright &copy; Annotations: 2008-2023 Ed de Moel.</p>
<p><b><i>Some specifications are "approved
for inclusion in a future standard". Note
that the MUMPS Development Committee cannot
guarantee that such future standards will
indeed be published.</i></b></p>
<p><font size="-1">This page most recently updated on 13-Sep-2014, 17:15:51.</font></p>
<p>For comments, <a href="mailto:demoel@jacquardsystems.com?Subject=Annotated%20Standards%20%28Frame%3dMain%2fPage%3da108040%2fEdition%3dMDC%29">contact Ed de Moel (demoel@jacquardsystems.com)</a></p>
</body>
</html>
